

; acme --cpu 6510 --format cbm --outfile foo.prg foo.asm
* = $0801                             ; BASIC start address (#2049)
!byte $0d,$08,$dc,$07,$9e,$20,$34,$39 ; BASIC loader to start at $c000...
!byte $31,$35,$32,$00,$00,$00         ; puts BASIC line 2012 SYS 49152
* = $c000                             ; start address for 6502 code

start
    lda #0
    sta $d020
    lda #0
    sta $d021
    lda #$15
    sta $d018

    ldx #$00
loop
    lda screen_001+2+0*$100,x
    sta $0400+0*$100,x
    lda screen_001+2+25*40+0*$100,x
    sta $d800+0*$100,x

    lda screen_001+2+1*$100,x
    sta $0400+1*$100,x
    lda screen_001+2+25*40+1*$100,x
    sta $d800+1*$100,x

    lda screen_001+2+2*$100,x
    sta $0400+2*$100,x
    lda screen_001+2+25*40+2*$100,x
    sta $d800+2*$100,x

    lda screen_001+2+$2e8,x
    sta $0400+$2e8,x
    lda screen_001+2+25*40+$2e8,x
    sta $d800+$2e8,x
    inx
    bne loop


;

   scn_start  = $0400   ; screen addresses
   scn_end    = $07E8
   col_start  = $D800   ; screen addresses
   col_end    = $DBE8
   
        LDA #sname_end-sname
        LDX #<sname
        LDY #>sname
        JSR $FFBD     ; call SETNAM
        LDA #$00
        LDX $BA       ; last used device number
        BNE .sskip
        LDX #$08      ; default to device 8
.sskip  LDY #$00
        JSR $FFBA     ; call SETLFS

        LDA #<scn_start
        STA $C1
        LDA #>scn_start
        STA $C2

        LDX #<scn_end
        LDY #>scn_end
        LDA #$C1      ; start address located in $C1/$C2
        JSR $FFD8     ; call SAVE
        BCS .error    ; if carry set, a load error has happened

        LDA #cname_end-cname
        LDX #<cname
        LDY #>cname
        JSR $FFBD     ; call SETNAM
        LDA #$00
        LDX $BA       ; last used device number
        BNE .cskip
        LDX #$08      ; default to device 8
.cskip  LDY #$00
        JSR $FFBA     ; call SETLFS

        LDA #<col_start
        STA $C1
        LDA #>col_start
        STA $C2

        LDX #<col_end
        LDY #>col_end
        LDA #$C1      ; start address located in $C1/$C2
        JSR $FFD8     ; call SAVE
        BCS .error    ; if carry set, a load error has happened

        
        
        jmp *;
 .error
 
        
sname  !text "LOADS"
sname_end
cname  !text "LOADC"
cname_end

; PETSCII memory layout (example for a 40x25 screen)
; byte  0         = border color
; byte  1         = background color
; bytes 2-1001    = screencodes
; bytes 1002-2001 = color
screen_001
!byte 0,0
!byte 102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,79,119,32,48,48,48,48,48,48,48,32,119,80
!byte 102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,116,32,32,32,32,32,32,32,32,32,32,32,106
!byte 102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,116,160,160,160,160,160,160,160,160,160,160,160,106
!byte 102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,116,160,160,160,160,160,160,160,160,160,160,160,106
!byte 102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,116,160,160,160,160,160,160,160,160,160,160,160,106
!byte 102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,116,160,160,160,160,160,160,160,160,160,160,160,106
!byte 102,102,102,102,79,119,119,119,119,119,119,119,119,119,119,119,119,119,119,119,119,119,80,102,102,102,102,116,160,32,32,32,32,32,32,32,32,32,160,106
!byte 102,102,102,102,116,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,106,102,102,102,102,116,160,32,12,15,1,4,9,14,7,32,160,106
!byte 102,102,102,102,116,32,32,16,18,15,10,5,3,20,32,45,32,54,52,32,32,32,106,102,102,102,102,116,160,32,32,32,32,32,32,32,32,32,160,106
!byte 102,102,102,102,116,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,106,102,102,102,102,116,160,160,160,160,160,160,160,160,160,160,160,106
!byte 102,102,102,102,116,32,32,4,1,14,14,25,32,1,18,14,15,12,4,32,32,32,106,102,102,102,102,116,160,160,160,160,160,160,160,160,160,160,160,106
!byte 102,102,102,102,116,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,106,102,102,102,102,116,160,160,160,160,160,160,160,160,160,160,160,106
!byte 102,102,102,102,116,32,32,102,102,40,3,41,32,50,48,49,57,32,32,32,32,32,106,102,102,102,102,116,160,160,160,160,160,160,160,160,160,160,160,106
!byte 102,102,102,102,116,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,106,102,102,102,102,116,160,160,160,160,160,160,160,160,160,160,160,106
!byte 102,102,102,102,76,111,111,111,111,111,111,111,111,111,111,111,111,111,111,111,111,111,122,102,102,102,102,116,32,32,32,32,32,32,32,32,32,32,32,106
!byte 102,102,102,102,102,160,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,160,102,102,102,102,102,79,119,119,119,119,119,119,119,119,119,119,119,80
!byte 102,102,102,102,160,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,160,102,102,102,102,116,32,218,32,218,32,218,32,218,32,218,32,106
!byte 102,102,102,160,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,160,102,102,102,116,32,32,32,32,32,32,32,32,32,32,32,106
!byte 102,102,160,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,160,102,102,116,32,216,32,216,32,216,32,216,32,216,32,106
!byte 102,160,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,160,102,116,32,32,32,32,32,32,32,32,32,32,32,106
!byte 160,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,160,79,119,119,119,119,119,119,119,119,119,119,119,80
!byte 102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,116,83,83,83,32,32,32,32,124,124,124,124,106
!byte 102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,79,119,119,119,119,119,119,119,119,119,119,119,80
!byte 102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,116,106,160,160,160,160,160,160,160,160,160,116,106
!byte 102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,102,76,111,111,111,111,111,111,111,111,111,111,111,122
!byte 3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,6,6,5,5,5,5,5,5,5,5,5,6,6
!byte 3,3,3,3,1,1,1,1,1,1,3,3,3,3,3,3,3,3,3,3,3,3,3,1,1,1,3,6,11,11,11,11,11,11,11,11,11,11,11,6
!byte 3,3,3,1,1,1,1,1,1,1,1,3,3,3,3,3,1,1,1,1,1,1,1,1,1,1,1,6,11,11,11,11,11,11,11,11,11,11,11,6
!byte 3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,6,11,11,11,11,11,11,11,11,11,11,11,6
!byte 3,3,3,3,3,9,9,8,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,9,8,3,6,11,11,11,11,11,11,11,11,11,11,11,6
!byte 14,14,14,14,9,9,8,8,8,14,14,14,14,14,14,14,14,14,14,14,14,14,14,9,8,8,8,6,11,11,11,11,11,11,11,11,11,11,11,6
!byte 14,14,14,9,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,8,8,8,8,6,11,11,11,11,11,11,11,11,11,11,11,6
!byte 14,14,9,9,1,15,15,15,15,15,15,15,6,15,15,1,1,1,1,1,1,15,1,8,8,8,8,6,11,11,11,11,11,11,11,11,11,11,11,6
!byte 14,9,9,8,1,15,7,7,7,7,7,7,7,7,7,7,7,7,7,15,15,15,1,8,8,8,8,6,11,11,11,11,11,11,11,11,11,11,11,6
!byte 9,9,8,8,1,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,1,8,8,8,8,6,11,11,11,11,11,11,11,11,11,11,11,6
!byte 9,8,8,8,1,15,15,7,7,7,7,7,7,7,7,7,7,7,7,15,15,15,1,8,8,8,8,6,11,11,11,11,11,11,11,11,11,11,11,6
!byte 5,5,5,5,1,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,1,5,5,5,5,6,11,11,11,11,11,11,11,11,11,11,11,6
!byte 13,13,13,13,1,15,15,0,0,7,7,7,7,7,7,7,7,15,15,15,15,15,1,13,13,13,13,6,11,11,11,11,11,11,11,11,11,11,11,6
!byte 5,5,5,5,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,5,5,5,5,6,11,11,11,11,11,11,11,11,11,11,11,6
!byte 13,13,13,13,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,13,13,13,13,6,14,14,14,14,14,14,14,14,14,14,14,6
!byte 5,5,5,5,5,1,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,1,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6
!byte 13,13,13,13,2,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,2,13,13,13,13,6,6,8,6,10,6,13,6,14,6,6,6,6
!byte 5,5,5,1,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,1,5,5,5,6,6,8,6,8,6,8,1,8,1,8,6,6
!byte 13,13,2,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,2,13,13,6,6,8,6,10,6,13,6,14,6,6,6,6
!byte 5,1,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,1,5,6,6,6,6,6,6,6,6,6,6,6,6,6
!byte 2,1,1,1,1,11,11,11,11,11,1,1,1,1,1,11,11,11,11,11,1,1,1,1,1,11,2,6,6,6,6,6,6,6,6,6,6,6,6,6
!byte 1,1,1,1,11,11,11,11,11,1,1,1,1,1,1,1,11,11,11,11,11,1,1,1,1,1,11,6,2,2,2,1,14,14,14,7,11,11,11,6
!byte 1,1,1,11,11,11,11,11,1,1,1,1,1,1,1,1,1,11,11,11,11,11,1,1,1,1,1,6,6,6,6,6,6,6,6,6,6,6,6,6
!byte 11,11,1,1,1,1,1,1,1,11,11,11,11,11,11,11,11,1,1,1,1,1,1,1,1,11,11,6,2,2,7,7,7,7,5,5,5,5,5,6
!byte 11,1,1,1,1,1,1,1,11,11,11,11,11,11,11,11,11,11,1,1,1,1,1,1,1,1,11,6,6,6,6,6,6,6,6,6,6,6,6,6
